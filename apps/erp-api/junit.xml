<?xml version="1.0" encoding="UTF-8"?>
<testsuites name="jest tests" tests="227" failures="95" errors="0" time="5.036">
  <testsuite name="Rate Limiter Middleware" errors="0" failures="17" skipped="0" timestamp="2025-08-17T22:26:59" time="0.904" tests="26">
    <testcase classname="Rate Limiter Middleware createRateLimiter should create rate limiter with default options" name="Rate Limiter Middleware createRateLimiter should create rate limiter with default options" time="0.016">
    </testcase>
    <testcase classname="Rate Limiter Middleware createRateLimiter should create rate limiter with custom options" name="Rate Limiter Middleware createRateLimiter should create rate limiter with custom options" time="0.008">
    </testcase>
    <testcase classname="Rate Limiter Middleware createRateLimiter should handle custom keyGenerator function" name="Rate Limiter Middleware createRateLimiter should handle custom keyGenerator function" time="0.002">
    </testcase>
    <testcase classname="Rate Limiter Middleware Client Identification should use IP address when user is not authenticated" name="Rate Limiter Middleware Client Identification should use IP address when user is not authenticated" time="0.005">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;clientId\&quot;:\&quot;192.168.1.1\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 2,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;isLimitExceeded\&quot;: true,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.569Z\&quot;
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_EXCEEDED\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 2,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.569Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:98:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Client Identification should use IP:userId when user is authenticated" name="Rate Limiter Middleware Client Identification should use IP:userId when user is authenticated" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;clientId\&quot;:\&quot;192.168.1.1:user123\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1:user123\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userId\&quot;: \&quot;user123\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 1,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.606Z\&quot;,
  \&quot;isLimitExceeded\&quot;: false,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.606Z\&quot;
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_SUCCESS\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1:user123\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userId\&quot;: \&quot;user123\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 1,
  \&quot;max\&quot;: 1,
  \&quot;remaining\&quot;: 0,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.606Z\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.606Z\&quot;,
  \&quot;duration\&quot;: \&quot;0ms\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:111:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Client Identification should fallback to connection.remoteAddress when x-forwarded-for is not available" name="Rate Limiter Middleware Client Identification should fallback to connection.remoteAddress when x-forwarded-for is not available" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;clientId\&quot;:\&quot;192.168.1.1\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 3,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;isLimitExceeded\&quot;: true,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.607Z\&quot;
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_EXCEEDED\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 3,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.607Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:124:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Rate Limiting Logic should allow requests within limit" name="Rate Limiter Middleware Rate Limiting Logic should allow requests within limit" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:138:24)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Rate Limiting Logic should block requests when limit is exceeded" name="Rate Limiter Middleware Rate Limiting Logic should block requests when limit is exceeded" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:156:24)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Rate Limiting Logic should reset counter after window expires" name="Rate Limiter Middleware Rate Limiting Logic should reset counter after window expires" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:183:24)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Rate Limit Headers should set standard rate limit headers" name="Rate Limiter Middleware Rate Limit Headers should set standard rate limit headers" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;X-RateLimit-Remaining&quot;, 4
Received
       1: &quot;X-RateLimit-Limit&quot;, 5
       2: &quot;X-RateLimit-Remaining&quot;, 0
       3: &quot;X-RateLimit-Reset&quot;, &quot;2025-08-17T22:42:00.553Z&quot;

Number of calls: 3
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:209:27)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Rate Limit Headers should set legacy rate limit headers when enabled" name="Rate Limiter Middleware Rate Limit Headers should set legacy rate limit headers when enabled" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;X-RateLimit-Remaining&quot;, 4
Received
       1: &quot;X-RateLimit-Limit&quot;, 5
       2: &quot;X-RateLimit-Remaining&quot;, 0
       3: &quot;X-RateLimit-Reset&quot;, &quot;2025-08-17T22:42:00.553Z&quot;

Number of calls: 6
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:223:27)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Rate Limit Headers should set remaining to 0 when limit is exceeded" name="Rate Limiter Middleware Rate Limit Headers should set remaining to 0 when limit is exceeded" time="0.001">
    </testcase>
    <testcase classname="Rate Limiter Middleware Predefined Rate Limiters strict should have correct default settings" name="Rate Limiter Middleware Predefined Rate Limiters strict should have correct default settings" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:244:28)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Predefined Rate Limiters standard should have correct default settings" name="Rate Limiter Middleware Predefined Rate Limiters standard should have correct default settings" time="0.013">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:266:28)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Predefined Rate Limiters loose should have correct default settings" name="Rate Limiter Middleware Predefined Rate Limiters loose should have correct default settings" time="0.005">
    </testcase>
    <testcase classname="Rate Limiter Middleware Predefined Rate Limiters api should use user ID when authenticated" name="Rate Limiter Middleware Predefined Rate Limiters api should use user ID when authenticated" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;clientId\&quot;:\&quot;192.168.1.1:user123\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;user123\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userId\&quot;: \&quot;user123\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 1,
  \&quot;max\&quot;: 1000,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.633Z\&quot;,
  \&quot;isLimitExceeded\&quot;: false,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.633Z\&quot;
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_SUCCESS\&quot;,
  \&quot;clientId\&quot;: \&quot;user123\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userId\&quot;: \&quot;user123\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 1,
  \&quot;max\&quot;: 1000,
  \&quot;remaining\&quot;: 999,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.633Z\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.633Z\&quot;,
  \&quot;duration\&quot;: \&quot;0ms\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:299:35)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Predefined Rate Limiters api should fallback to IP when not authenticated" name="Rate Limiter Middleware Predefined Rate Limiters api should fallback to IP when not authenticated" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;clientId\&quot;:\&quot;192.168.1.1\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 202,
  \&quot;max\&quot;: 1000,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;isLimitExceeded\&quot;: false,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.633Z\&quot;
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_SUCCESS\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 202,
  \&quot;max\&quot;: 1000,
  \&quot;remaining\&quot;: 798,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.633Z\&quot;,
  \&quot;duration\&quot;: \&quot;0ms\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:311:35)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Logging should log rate limit checks" name="Rate Limiter Middleware Logging should log rate limit checks" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;type\&quot;:\&quot;RATE_LIMIT_CHECK\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 203,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;isLimitExceeded\&quot;: true,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.634Z\&quot;
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_EXCEEDED\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 203,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.634Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:326:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Logging should log rate limit exceeded events" name="Rate Limiter Middleware Logging should log rate limit exceeded events" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;type\&quot;:\&quot;RATE_LIMIT_EXCEEDED\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 204,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;isLimitExceeded\&quot;: true,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.635Z\&quot;
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_EXCEEDED\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 204,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.635Z\&quot;
}
&quot;, &quot;utf8&quot;
       3: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 205,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;isLimitExceeded\&quot;: true,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.635Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 4
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:343:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Logging should log successful rate limit checks" name="Rate Limiter Middleware Logging should log successful rate limit checks" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;type\&quot;:\&quot;RATE_LIMIT_SUCCESS\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_CHECK\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 206,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;isLimitExceeded\&quot;: true,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.635Z\&quot;
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RATE_LIMIT_EXCEEDED\&quot;,
  \&quot;clientId\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;count\&quot;: 206,
  \&quot;max\&quot;: 1,
  \&quot;windowMs\&quot;: 900000,
  \&quot;resetTime\&quot;: \&quot;2025-08-17T22:42:00.553Z\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.635Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:355:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Custom Handlers should call custom handler when limit is exceeded" name="Rate Limiter Middleware Custom Handlers should call custom handler when limit is exceeded" time="0.001">
    </testcase>
    <testcase classname="Rate Limiter Middleware Custom Handlers should call onLimitReached callback when limit is exceeded" name="Rate Limiter Middleware Custom Handlers should call onLimitReached callback when limit is exceeded" time="0">
    </testcase>
    <testcase classname="Rate Limiter Middleware applyRateLimiting should apply rate limiting to routes" name="Rate Limiter Middleware applyRateLimiting should apply rate limiting to routes" time="0.001">
    </testcase>
    <testcase classname="Rate Limiter Middleware applyRateLimiting should handle custom middleware functions" name="Rate Limiter Middleware applyRateLimiting should handle custom middleware functions" time="0">
    </testcase>
    <testcase classname="Rate Limiter Middleware Memory Management should clean expired entries periodically" name="Rate Limiter Middleware Memory Management should clean expired entries periodically" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:450:24)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Rate Limiter Middleware Error Handling should handle errors gracefully" name="Rate Limiter Middleware Error Handling should handle errors gracefully" time="0">
      <failure>Error: File system error
    at Object.&lt;anonymous&gt; (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:460:15)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-mock/build/index.js:305:39
    at Object.&lt;anonymous&gt; (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-mock/build/index.js:312:13)
    at Object.mockConstructor (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-mock/build/index.js:102:19)
    at Object.appendFileSync (eval at _createMockFunction (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-mock/build/index.js:460:31), &lt;anonymous&gt;:3:60)
    at appendFileSync (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/rateLimiter.js:29:6)
    at writeLog (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/rateLimiter.js:127:5)
    at Object.limiter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/rateLimiter.test.js:466:7)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
  </testsuite>
  <testsuite name="Validation Middleware" errors="0" failures="5" skipped="0" timestamp="2025-08-17T22:26:59" time="1.104" tests="43">
    <testcase classname="Validation Middleware Validators validateType should validate string type correctly" name="Validation Middleware Validators validateType should validate string type correctly" time="0.003">
    </testcase>
    <testcase classname="Validation Middleware Validators validateType should validate number type correctly" name="Validation Middleware Validators validateType should validate number type correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateType should validate boolean type correctly" name="Validation Middleware Validators validateType should validate boolean type correctly" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware Validators validateType should validate object type correctly" name="Validation Middleware Validators validateType should validate object type correctly" time="0.002">
      <failure>Error: expect(received).toBe(expected) // Object.is equality

Expected: false
Received: true
    at Object.toBe (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/validation.test.js:83:55)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Validation Middleware Validators validateType should validate array type correctly" name="Validation Middleware Validators validateType should validate array type correctly" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware Validators validatePattern should validate regex patterns correctly" name="Validation Middleware Validators validatePattern should validate regex patterns correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validatePattern should validate string patterns correctly" name="Validation Middleware Validators validatePattern should validate string patterns correctly" time="0.005">
    </testcase>
    <testcase classname="Validation Middleware Validators validatePattern should handle invalid regex patterns gracefully" name="Validation Middleware Validators validatePattern should handle invalid regex patterns gracefully" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateLength should validate minimum length correctly" name="Validation Middleware Validators validateLength should validate minimum length correctly" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware Validators validateLength should validate maximum length correctly" name="Validation Middleware Validators validateLength should validate maximum length correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateLength should validate both min and max length correctly" name="Validation Middleware Validators validateLength should validate both min and max length correctly" time="0.005">
    </testcase>
    <testcase classname="Validation Middleware Validators validateLength should return true for non-string values" name="Validation Middleware Validators validateLength should return true for non-string values" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware Validators validateRange should validate minimum value correctly" name="Validation Middleware Validators validateRange should validate minimum value correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateRange should validate maximum value correctly" name="Validation Middleware Validators validateRange should validate maximum value correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateRange should validate both min and max values correctly" name="Validation Middleware Validators validateRange should validate both min and max values correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateRange should return true for non-number values" name="Validation Middleware Validators validateRange should return true for non-number values" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware Validators validateRequired should validate required fields correctly" name="Validation Middleware Validators validateRequired should validate required fields correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateRequired should reject undefined and null values" name="Validation Middleware Validators validateRequired should reject undefined and null values" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateRequired should reject empty strings" name="Validation Middleware Validators validateRequired should reject empty strings" time="0">
    </testcase>
    <testcase classname="Validation Middleware Validators validateRequired should reject empty arrays" name="Validation Middleware Validators validateRequired should reject empty arrays" time="0">
    </testcase>
    <testcase classname="Validation Middleware validateData should validate required fields" name="Validation Middleware validateData should validate required fields" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware validateData should validate field types" name="Validation Middleware validateData should validate field types" time="0">
    </testcase>
    <testcase classname="Validation Middleware validateData should validate patterns" name="Validation Middleware validateData should validate patterns" time="0">
    </testcase>
    <testcase classname="Validation Middleware validateData should validate length constraints" name="Validation Middleware validateData should validate length constraints" time="0">
    </testcase>
    <testcase classname="Validation Middleware validateData should validate range constraints" name="Validation Middleware validateData should validate range constraints" time="0">
    </testcase>
    <testcase classname="Validation Middleware validateData should validate nested objects" name="Validation Middleware validateData should validate nested objects" time="0">
    </testcase>
    <testcase classname="Validation Middleware validateData should validate arrays" name="Validation Middleware validateData should validate arrays" time="0.007">
      <failure>Error: expect(received).toHaveLength(expected)

Expected length: 1
Received length: 0
Received array:  []
    at Object.toHaveLength (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/validation.test.js:292:22)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Validation Middleware validateData should skip validation for non-required empty fields" name="Validation Middleware validateData should skip validation for non-required empty fields" time="0.004">
    </testcase>
    <testcase classname="Validation Middleware createValidationMiddleware should return 500 when schema is not found" name="Validation Middleware createValidationMiddleware should return 500 when schema is not found" time="0.01">
    </testcase>
    <testcase classname="Validation Middleware createValidationMiddleware should validate body data by default" name="Validation Middleware createValidationMiddleware should validate body data by default" time="0.003">
    </testcase>
    <testcase classname="Validation Middleware createValidationMiddleware should validate query data when specified" name="Validation Middleware createValidationMiddleware should validate query data when specified" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware createValidationMiddleware should validate params data when specified" name="Validation Middleware createValidationMiddleware should validate params data when specified" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware createValidationMiddleware should call next() when validation passes" name="Validation Middleware createValidationMiddleware should call next() when validation passes" time="0">
    </testcase>
    <testcase classname="Validation Middleware createValidationMiddleware should log validation errors" name="Validation Middleware createValidationMiddleware should log validation errors" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;type\&quot;:\&quot;VALIDATION_FAILED\&quot;&quot;, &quot;utf8&quot;
Received: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;VALIDATION_FAILED\&quot;,
  \&quot;schema\&quot;: \&quot;user\&quot;,
  \&quot;errors\&quot;: [
    {
      \&quot;field\&quot;: \&quot;email\&quot;,
      \&quot;message\&quot;: \&quot;Email must be a valid email address\&quot;,
      \&quot;code\&quot;: \&quot;INVALID_FORMAT\&quot;,
      \&quot;pattern\&quot;: \&quot;/^[^\\\\s@]+@[^\\\\s@]+\\\\.[^\\\\s@]+$/\&quot;
    },
    {
      \&quot;field\&quot;: \&quot;password\&quot;,
      \&quot;message\&quot;: \&quot;Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character\&quot;,
      \&quot;code\&quot;: \&quot;REQUIRED_FIELD_MISSING\&quot;
    },
    {
      \&quot;field\&quot;: \&quot;firstName\&quot;,
      \&quot;message\&quot;: \&quot;First name must be 2-50 characters long and contain only letters, spaces, hyphens, and apostrophes\&quot;,
      \&quot;code\&quot;: \&quot;REQUIRED_FIELD_MISSING\&quot;
    },
    {
      \&quot;field\&quot;: \&quot;lastName\&quot;,
      \&quot;message\&quot;: \&quot;Last name must be 2-50 characters long and contain only letters, spaces, hyphens, and apostrophes\&quot;,
      \&quot;code\&quot;: \&quot;REQUIRED_FIELD_MISSING\&quot;
    }
  ],
  \&quot;data\&quot;: {
    \&quot;email\&quot;: \&quot;invalid-email\&quot;
  },
  \&quot;method\&quot;: \&quot;POST\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.707Z\&quot;,
  \&quot;duration\&quot;: \&quot;0ms\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/validation.test.js:385:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Validation Middleware createValidationMiddleware should log successful validations" name="Validation Middleware createValidationMiddleware should log successful validations" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;type\&quot;:\&quot;VALIDATION_SUCCESS\&quot;&quot;, &quot;utf8&quot;
Received: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;VALIDATION_SUCCESS\&quot;,
  \&quot;schema\&quot;: \&quot;user\&quot;,
  \&quot;method\&quot;: \&quot;POST\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:00.708Z\&quot;,
  \&quot;duration\&quot;: \&quot;0ms\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/validation.test.js:403:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Validation Middleware Predefined Validation Middleware validateUser should validate user data correctly" name="Validation Middleware Predefined Validation Middleware validateUser should validate user data correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Predefined Validation Middleware validateUser should reject invalid user data" name="Validation Middleware Predefined Validation Middleware validateUser should reject invalid user data" time="0">
    </testcase>
    <testcase classname="Validation Middleware Predefined Validation Middleware validateProfile should validate profile data correctly" name="Validation Middleware Predefined Validation Middleware validateProfile should validate profile data correctly" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware Predefined Validation Middleware validateProfile should reject invalid profile data" name="Validation Middleware Predefined Validation Middleware validateProfile should reject invalid profile data" time="0">
    </testcase>
    <testcase classname="Validation Middleware Predefined Validation Middleware validateBooking should validate booking data correctly" name="Validation Middleware Predefined Validation Middleware validateBooking should validate booking data correctly" time="0">
    </testcase>
    <testcase classname="Validation Middleware Predefined Validation Middleware validateBooking should reject invalid booking data" name="Validation Middleware Predefined Validation Middleware validateBooking should reject invalid booking data" time="0.001">
    </testcase>
    <testcase classname="Validation Middleware Error Handling should handle validation exceptions gracefully" name="Validation Middleware Error Handling should handle validation exceptions gracefully" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: 500
Received: 400

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/validation.test.js:518:30)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Validation Middleware Integration should work with real Express app" name="Validation Middleware Integration should work with real Express app" time="0.146">
    </testcase>
  </testsuite>
  <testsuite name="Authorize Middleware" errors="0" failures="2" skipped="0" timestamp="2025-08-17T22:27:00" time="0.275" tests="20">
    <testcase classname="Authorize Middleware User Authentication Check should return 401 when user is not authenticated" name="Authorize Middleware User Authentication Check should return 401 when user is not authenticated" time="0.023">
    </testcase>
    <testcase classname="Authorize Middleware User Authentication Check should return 401 when req.user is null" name="Authorize Middleware User Authentication Check should return 401 when req.user is null" time="0.001">
    </testcase>
    <testcase classname="Authorize Middleware Role Assignment Check should return 403 when user has no role assigned" name="Authorize Middleware Role Assignment Check should return 403 when user has no role assigned" time="0.002">
    </testcase>
    <testcase classname="Authorize Middleware Role Assignment Check should return 403 when user.role is null" name="Authorize Middleware Role Assignment Check should return 403 when user.role is null" time="0.001">
    </testcase>
    <testcase classname="Authorize Middleware Role Assignment Check should return 403 when user.role is undefined" name="Authorize Middleware Role Assignment Check should return 403 when user.role is undefined" time="0.001">
    </testcase>
    <testcase classname="Authorize Middleware Role Validation - Single Role should allow access when user role matches single allowed role" name="Authorize Middleware Role Validation - Single Role should allow access when user role matches single allowed role" time="0.002">
    </testcase>
    <testcase classname="Authorize Middleware Role Validation - Single Role should deny access when user role does not match single allowed role" name="Authorize Middleware Role Validation - Single Role should deny access when user role does not match single allowed role" time="0.002">
    </testcase>
    <testcase classname="Authorize Middleware Role Validation - Multiple Roles should allow access when user role is in allowed roles array" name="Authorize Middleware Role Validation - Multiple Roles should allow access when user role is in allowed roles array" time="0.001">
    </testcase>
    <testcase classname="Authorize Middleware Role Validation - Multiple Roles should allow access when user role is in allowed roles array (different position)" name="Authorize Middleware Role Validation - Multiple Roles should allow access when user role is in allowed roles array (different position)" time="0.004">
    </testcase>
    <testcase classname="Authorize Middleware Role Validation - Multiple Roles should deny access when user role is not in allowed roles array" name="Authorize Middleware Role Validation - Multiple Roles should deny access when user role is not in allowed roles array" time="0.001">
    </testcase>
    <testcase classname="Authorize Middleware User Metadata Role Fallback should use user_metadata.role when user.role is not available" name="Authorize Middleware User Metadata Role Fallback should use user_metadata.role when user.role is not available" time="0">
    </testcase>
    <testcase classname="Authorize Middleware User Metadata Role Fallback should prioritize user.role over user_metadata.role" name="Authorize Middleware User Metadata Role Fallback should prioritize user.role over user_metadata.role" time="0.001">
    </testcase>
    <testcase classname="Authorize Middleware Request Enhancement should add userRole to request object" name="Authorize Middleware Request Enhancement should add userRole to request object" time="0">
    </testcase>
    <testcase classname="Authorize Middleware Request Enhancement should add authorizedRoles to request object" name="Authorize Middleware Request Enhancement should add authorizedRoles to request object" time="0.001">
    </testcase>
    <testcase classname="Authorize Middleware Request Enhancement should add authorizationTime to request object" name="Authorize Middleware Request Enhancement should add authorizationTime to request object" time="0">
    </testcase>
    <testcase classname="Authorize Middleware Error Handling should handle unexpected errors gracefully" name="Authorize Middleware Error Handling should handle unexpected errors gracefully" time="0.018">
    </testcase>
    <testcase classname="Authorize Middleware Edge Cases should handle empty allowed roles array" name="Authorize Middleware Edge Cases should handle empty allowed roles array" time="0">
    </testcase>
    <testcase classname="Authorize Middleware Edge Cases should handle null allowed roles" name="Authorize Middleware Edge Cases should handle null allowed roles" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: 403

Number of calls: 0
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/authorize.test.js:362:30)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Authorize Middleware Edge Cases should handle undefined allowed roles" name="Authorize Middleware Edge Cases should handle undefined allowed roles" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: 403

Number of calls: 0
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/authorize.test.js:383:30)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Authorize Middleware Performance should complete authorization within reasonable time" name="Authorize Middleware Performance should complete authorization within reasonable time" time="0.001">
    </testcase>
  </testsuite>
  <testsuite name="CanAccessOwnData Middleware" errors="0" failures="3" skipped="0" timestamp="2025-08-17T22:27:01" time="0.25" tests="23">
    <testcase classname="CanAccessOwnData Middleware User Authentication Check should return 401 when user is not authenticated" name="CanAccessOwnData Middleware User Authentication Check should return 401 when user is not authenticated" time="0.012">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware User Authentication Check should return 401 when req.user is null" name="CanAccessOwnData Middleware User Authentication Check should return 401 when req.user is null" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware User Authentication Check should return 401 when req.user.id is undefined" name="CanAccessOwnData Middleware User Authentication Check should return 401 when req.user.id is undefined" time="0.002">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware UserId Parameter Validation should return 400 when userId parameter is missing" name="CanAccessOwnData Middleware UserId Parameter Validation should return 400 when userId parameter is missing" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware UserId Parameter Validation should return 400 when userId parameter is undefined" name="CanAccessOwnData Middleware UserId Parameter Validation should return 400 when userId parameter is undefined" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware UserId Parameter Validation should return 400 when userId parameter is null" name="CanAccessOwnData Middleware UserId Parameter Validation should return 400 when userId parameter is null" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware UserId Format Validation should return 400 when userId parameter is empty string" name="CanAccessOwnData Middleware UserId Format Validation should return 400 when userId parameter is empty string" time="0.016">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

- Expected
+ Received

  Object {
-   &quot;code&quot;: &quot;INVALID_USER_ID&quot;,
-   &quot;error&quot;: &quot;Invalid parameter&quot;,
-   &quot;message&quot;: &quot;userId parameter is invalid&quot;,
+   &quot;code&quot;: &quot;MISSING_USER_ID&quot;,
+   &quot;error&quot;: &quot;Missing parameter&quot;,
+   &quot;message&quot;: &quot;userId parameter is required&quot;,
  },

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/canAccessOwnData.test.js:144:28)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="CanAccessOwnData Middleware UserId Format Validation should return 400 when userId parameter is whitespace only" name="CanAccessOwnData Middleware UserId Format Validation should return 400 when userId parameter is whitespace only" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware UserId Format Validation should return 400 when userId parameter is too short after trimming" name="CanAccessOwnData Middleware UserId Format Validation should return 400 when userId parameter is too short after trimming" time="0">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: 400
Received: 403

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/canAccessOwnData.test.js:169:30)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Access Control Logic should allow access when user ID matches userId parameter" name="CanAccessOwnData Middleware Access Control Logic should allow access when user ID matches userId parameter" time="0">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Access Control Logic should allow access when user ID matches userId parameter after trimming" name="CanAccessOwnData Middleware Access Control Logic should allow access when user ID matches userId parameter after trimming" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Access Control Logic should deny access when user ID does not match userId parameter" name="CanAccessOwnData Middleware Access Control Logic should deny access when user ID does not match userId parameter" time="0">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Access Control Logic should deny access when user ID does not match userId parameter (case sensitive)" name="CanAccessOwnData Middleware Access Control Logic should deny access when user ID does not match userId parameter (case sensitive)" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Request Enhancement should add accessControlTime to request object" name="CanAccessOwnData Middleware Request Enhancement should add accessControlTime to request object" time="0.002">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Request Enhancement should add requestedUserId to request object" name="CanAccessOwnData Middleware Request Enhancement should add requestedUserId to request object" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Request Enhancement should add requestedUserId after trimming" name="CanAccessOwnData Middleware Request Enhancement should add requestedUserId after trimming" time="0.002">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Error Handling should handle unexpected errors gracefully" name="CanAccessOwnData Middleware Error Handling should handle unexpected errors gracefully" time="0.006">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Edge Cases should handle numeric user IDs" name="CanAccessOwnData Middleware Edge Cases should handle numeric user IDs" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/canAccessOwnData.test.js:307:24)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Edge Cases should handle UUID user IDs" name="CanAccessOwnData Middleware Edge Cases should handle UUID user IDs" time="0">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Edge Cases should handle special characters in user IDs" name="CanAccessOwnData Middleware Edge Cases should handle special characters in user IDs" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Performance should complete access control check within reasonable time" name="CanAccessOwnData Middleware Performance should complete access control check within reasonable time" time="0">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Integration Scenarios should work with different HTTP methods" name="CanAccessOwnData Middleware Integration Scenarios should work with different HTTP methods" time="0.001">
    </testcase>
    <testcase classname="CanAccessOwnData Middleware Integration Scenarios should work with different URL patterns" name="CanAccessOwnData Middleware Integration Scenarios should work with different URL patterns" time="0.001">
    </testcase>
  </testsuite>
  <testsuite name="Auth Middleware" errors="0" failures="7" skipped="0" timestamp="2025-08-17T22:27:01" time="0.288" tests="18">
    <testcase classname="Auth Middleware Token Validation should return 401 when no token is provided" name="Auth Middleware Token Validation should return 401 when no token is provided" time="0.031">
    </testcase>
    <testcase classname="Auth Middleware Token Validation should return 401 when token format is invalid" name="Auth Middleware Token Validation should return 401 when token format is invalid" time="0.01">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

- Expected
+ Received

  Object {
-   &quot;code&quot;: &quot;INVALID_TOKEN_FORMAT&quot;,
-   &quot;error&quot;: &quot;Invalid token format&quot;,
-   &quot;message&quot;: &quot;The provided token is malformed&quot;,
+   &quot;code&quot;: &quot;INVALID_TOKEN_SIGNATURE&quot;,
+   &quot;error&quot;: &quot;Invalid token&quot;,
+   &quot;message&quot;: &quot;Invalid token signature&quot;,
  },

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/auth.test.js:105:28)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
    <testcase classname="Auth Middleware Token Validation should return 401 when token is too short" name="Auth Middleware Token Validation should return 401 when token is too short" time="0.002">
    </testcase>
    <testcase classname="Auth Middleware JWT Verification should return 401 when JWT verification fails" name="Auth Middleware JWT Verification should return 401 when JWT verification fails" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

- Expected
+ Received

  Object {
-   &quot;code&quot;: &quot;TOKEN_VERIFICATION_FAILED&quot;,
+   &quot;code&quot;: &quot;INVALID_TOKEN_SIGNATURE&quot;,
    &quot;error&quot;: &quot;Invalid token&quot;,
-   &quot;message&quot;: &quot;Token verification failed&quot;,
+   &quot;message&quot;: &quot;Invalid token signature&quot;,
  },

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/auth.test.js:135:28)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
    <testcase classname="Auth Middleware JWT Verification should return 401 when token has expired" name="Auth Middleware JWT Verification should return 401 when token has expired" time="0.003">
    </testcase>
    <testcase classname="Auth Middleware JWT Verification should return 401 when token has invalid signature" name="Auth Middleware JWT Verification should return 401 when token has invalid signature" time="0.002">
    </testcase>
    <testcase classname="Auth Middleware Token Claims Validation should return 401 when token is missing userId" name="Auth Middleware Token Claims Validation should return 401 when token is missing userId" time="0.002">
    </testcase>
    <testcase classname="Auth Middleware Token Claims Validation should return 401 when token is missing email" name="Auth Middleware Token Claims Validation should return 401 when token is missing email" time="0.002">
    </testcase>
    <testcase classname="Auth Middleware Successful Authentication should call next() when token is valid" name="Auth Middleware Successful Authentication should call next() when token is valid" time="0.002">
    </testcase>
    <testcase classname="Auth Middleware Successful Authentication should set user object in request" name="Auth Middleware Successful Authentication should set user object in request" time="0.002">
    </testcase>
    <testcase classname="Auth Middleware Successful Authentication should set authToken in request" name="Auth Middleware Successful Authentication should set authToken in request" time="0.001">
    </testcase>
    <testcase classname="Auth Middleware Successful Authentication should set authTime in request" name="Auth Middleware Successful Authentication should set authTime in request" time="0.002">
    </testcase>
    <testcase classname="Auth Middleware Successful Authentication should set jwtPayload in request" name="Auth Middleware Successful Authentication should set jwtPayload in request" time="0.001">
    </testcase>
    <testcase classname="Auth Middleware Error Handling should handle unexpected errors gracefully" name="Auth Middleware Error Handling should handle unexpected errors gracefully" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: 500
Received: 401

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/auth.test.js:283:30)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
    <testcase classname="Auth Middleware Edge Cases should handle Bearer token with extra spaces" name="Auth Middleware Edge Cases should handle Bearer token with extra spaces" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/auth.test.js:299:24)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
    <testcase classname="Auth Middleware Edge Cases should handle different IP address sources" name="Auth Middleware Edge Cases should handle different IP address sources" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/auth.test.js:311:24)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
    <testcase classname="Auth Middleware Edge Cases should set default role when not provided in token" name="Auth Middleware Edge Cases should set default role when not provided in token" time="0.007">
      <failure>TypeError: Cannot read properties of undefined (reading &apos;role&apos;)
    at Object.role (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/auth.test.js:326:27)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
    <testcase classname="Auth Middleware Performance should complete authentication within reasonable time" name="Auth Middleware Performance should complete authentication within reasonable time" time="0.005">
      <failure>Error: expect(jest.fn()).toHaveBeenCalled()

Expected number of calls: &gt;= 1
Received number of calls:    0
    at Object.toHaveBeenCalled (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/auth.test.js:341:24)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
  </testsuite>
  <testsuite name="Logger Middleware" errors="0" failures="8" skipped="0" timestamp="2025-08-17T22:27:01" time="0.503" tests="13">
    <testcase classname="Logger Middleware requestLogger should log request details and store start time" name="Logger Middleware requestLogger should log request details and store start time" time="0.043">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;type\&quot;:\&quot;REQUEST\&quot;&quot;, &quot;utf8&quot;
Received: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;REQUEST\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;path\&quot;: \&quot;/test\&quot;,
  \&quot;query\&quot;: {},
  \&quot;params\&quot;: {},
  \&quot;headers\&quot;: {
    \&quot;user-agent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
    \&quot;accept\&quot;: \&quot;application/json\&quot;,
    \&quot;x-forwarded-for\&quot;: \&quot;192.168.1.1\&quot;,
    \&quot;accept-language\&quot;: \&quot;en-US,en;q=0.9\&quot;,
    \&quot;x-timezone\&quot;: \&quot;UTC\&quot;
  },
  \&quot;body\&quot;: {},
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: {
    \&quot;isMobile\&quot;: false,
    \&quot;isBot\&quot;: false,
    \&quot;raw\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;
  },
  \&quot;language\&quot;: {
    \&quot;preferred\&quot;: \&quot;en-US\&quot;,
    \&quot;all\&quot;: [
      {
        \&quot;language\&quot;: \&quot;en-US\&quot;,
        \&quot;quality\&quot;: 1
      },
      {
        \&quot;language\&quot;: \&quot;en\&quot;,
        \&quot;quality\&quot;: 0.9
      }
    ],
    \&quot;acceptLanguage\&quot;: \&quot;en-US,en;q=0.9\&quot;
  },
  \&quot;timezone\&quot;: {
    \&quot;timezone\&quot;: \&quot;UTC\&quot;,
    \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.569Z\&quot;,
    \&quot;serverTimezone\&quot;: \&quot;Europe/Brussels\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.605Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/logger.test.js:92:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Logger Middleware requestLogger should capture request headers and body" name="Logger Middleware requestLogger should capture request headers and body" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;user-agent\&quot;:\&quot;Mozilla/5.0 (Test Browser)\&quot;&quot;, &quot;utf8&quot;
Received: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;REQUEST\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;path\&quot;: \&quot;/test\&quot;,
  \&quot;query\&quot;: {},
  \&quot;params\&quot;: {},
  \&quot;headers\&quot;: {
    \&quot;user-agent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
    \&quot;accept\&quot;: \&quot;application/json\&quot;,
    \&quot;x-forwarded-for\&quot;: \&quot;192.168.1.1\&quot;,
    \&quot;accept-language\&quot;: \&quot;en-US,en;q=0.9\&quot;,
    \&quot;x-timezone\&quot;: \&quot;UTC\&quot;
  },
  \&quot;body\&quot;: {},
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: {
    \&quot;isMobile\&quot;: false,
    \&quot;isBot\&quot;: false,
    \&quot;raw\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;
  },
  \&quot;language\&quot;: {
    \&quot;preferred\&quot;: \&quot;en-US\&quot;,
    \&quot;all\&quot;: [
      {
        \&quot;language\&quot;: \&quot;en-US\&quot;,
        \&quot;quality\&quot;: 1
      },
      {
        \&quot;language\&quot;: \&quot;en\&quot;,
        \&quot;quality\&quot;: 0.9
      }
    ],
    \&quot;acceptLanguage\&quot;: \&quot;en-US,en;q=0.9\&quot;
  },
  \&quot;timezone\&quot;: {
    \&quot;timezone\&quot;: \&quot;UTC\&quot;,
    \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.619Z\&quot;,
    \&quot;serverTimezone\&quot;: \&quot;Europe/Brussels\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.619Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/logger.test.js:102:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Logger Middleware requestLogger should redact authorization header" name="Logger Middleware requestLogger should redact authorization header" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;authorization\&quot;:\&quot;[REDACTED]\&quot;&quot;, &quot;utf8&quot;
Received: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;REQUEST\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;path\&quot;: \&quot;/test\&quot;,
  \&quot;query\&quot;: {},
  \&quot;params\&quot;: {},
  \&quot;headers\&quot;: {
    \&quot;user-agent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
    \&quot;accept\&quot;: \&quot;application/json\&quot;,
    \&quot;authorization\&quot;: \&quot;[REDACTED]\&quot;,
    \&quot;x-forwarded-for\&quot;: \&quot;192.168.1.1\&quot;,
    \&quot;accept-language\&quot;: \&quot;en-US,en;q=0.9\&quot;,
    \&quot;x-timezone\&quot;: \&quot;UTC\&quot;
  },
  \&quot;body\&quot;: {},
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: {
    \&quot;isMobile\&quot;: false,
    \&quot;isBot\&quot;: false,
    \&quot;raw\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;
  },
  \&quot;language\&quot;: {
    \&quot;preferred\&quot;: \&quot;en-US\&quot;,
    \&quot;all\&quot;: [
      {
        \&quot;language\&quot;: \&quot;en-US\&quot;,
        \&quot;quality\&quot;: 1
      },
      {
        \&quot;language\&quot;: \&quot;en\&quot;,
        \&quot;quality\&quot;: 0.9
      }
    ],
    \&quot;acceptLanguage\&quot;: \&quot;en-US,en;q=0.9\&quot;
  },
  \&quot;timezone\&quot;: {
    \&quot;timezone\&quot;: \&quot;UTC\&quot;,
    \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.621Z\&quot;,
    \&quot;serverTimezone\&quot;: \&quot;Europe/Brussels\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.621Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/logger.test.js:119:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Logger Middleware responseLogger should log response details when response finishes" name="Logger Middleware responseLogger should log response details when response finishes" time="0.003">
    </testcase>
    <testcase classname="Logger Middleware responseLogger should calculate and log response duration" name="Logger Middleware responseLogger should calculate and log response duration" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;duration\&quot;:\&quot;150ms\&quot;&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;RESPONSE\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;path\&quot;: \&quot;/test\&quot;,
  \&quot;statusCode\&quot;: 200,
  \&quot;statusMessage\&quot;: \&quot;OK\&quot;,
  \&quot;duration\&quot;: \&quot;150ms\&quot;,
  \&quot;responseSize\&quot;: \&quot;1024\&quot;,
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.626Z\&quot;,
  \&quot;requestId\&quot;: 1755469621476
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;REQUEST_RESPONSE\&quot;,
  \&quot;requestId\&quot;: 1755469621476,
  \&quot;request\&quot;: {
    \&quot;method\&quot;: \&quot;GET\&quot;,
    \&quot;url\&quot;: \&quot;/test\&quot;,
    \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
    \&quot;userAgent\&quot;: {
      \&quot;isMobile\&quot;: false,
      \&quot;isBot\&quot;: false,
      \&quot;raw\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;
    },
    \&quot;language\&quot;: {
      \&quot;preferred\&quot;: \&quot;en-US\&quot;,
      \&quot;all\&quot;: [
        {
          \&quot;language\&quot;: \&quot;en-US\&quot;,
          \&quot;quality\&quot;: 1
        },
        {
          \&quot;language\&quot;: \&quot;en\&quot;,
          \&quot;quality\&quot;: 0.9
        }
      ],
      \&quot;acceptLanguage\&quot;: \&quot;en-US,en;q=0.9\&quot;
    },
    \&quot;timezone\&quot;: {
      \&quot;timezone\&quot;: \&quot;UTC\&quot;,
      \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.627Z\&quot;,
      \&quot;serverTimezone\&quot;: \&quot;Europe/Brussels\&quot;
    },
    \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.476Z\&quot;
  },
  \&quot;response\&quot;: {
    \&quot;statusCode\&quot;: 200,
    \&quot;duration\&quot;: \&quot;150ms\&quot;,
    \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.627Z\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.627Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/logger.test.js:158:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Logger Middleware errorLogger should log error details" name="Logger Middleware errorLogger should log error details" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;type\&quot;:\&quot;ERROR\&quot;&quot;, &quot;utf8&quot;
Received: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;ERROR\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;path\&quot;: \&quot;/test\&quot;,
  \&quot;error\&quot;: {
    \&quot;message\&quot;: \&quot;Test error\&quot;,
    \&quot;stack\&quot;: \&quot;Error: Test error\\n    at test.js:1:1\&quot;,
    \&quot;name\&quot;: \&quot;Error\&quot;
  },
  \&quot;request\&quot;: {
    \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
    \&quot;userAgent\&quot;: {
      \&quot;isMobile\&quot;: false,
      \&quot;isBot\&quot;: false,
      \&quot;raw\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;
    },
    \&quot;language\&quot;: {
      \&quot;preferred\&quot;: \&quot;en-US\&quot;,
      \&quot;all\&quot;: [
        {
          \&quot;language\&quot;: \&quot;en-US\&quot;,
          \&quot;quality\&quot;: 1
        },
        {
          \&quot;language\&quot;: \&quot;en\&quot;,
          \&quot;quality\&quot;: 0.9
        }
      ],
      \&quot;acceptLanguage\&quot;: \&quot;en-US,en;q=0.9\&quot;
    },
    \&quot;timezone\&quot;: {
      \&quot;timezone\&quot;: \&quot;UTC\&quot;,
      \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.629Z\&quot;,
      \&quot;serverTimezone\&quot;: \&quot;Europe/Brussels\&quot;
    },
    \&quot;body\&quot;: {},
    \&quot;query\&quot;: {},
    \&quot;params\&quot;: {}
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.629Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/logger.test.js:173:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Logger Middleware performanceLogger should log performance data when response finishes" name="Logger Middleware performanceLogger should log performance data when response finishes" time="0.002">
    </testcase>
    <testcase classname="Logger Middleware performanceLogger should log slow requests separately" name="Logger Middleware performanceLogger should log slow requests separately" time="0">
    </testcase>
    <testcase classname="Logger Middleware securityLogger should log security data for all requests" name="Logger Middleware securityLogger should log security data for all requests" time="0.002">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;type\&quot;:\&quot;SECURITY\&quot;&quot;, &quot;utf8&quot;
Received: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;SECURITY\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
  \&quot;headers\&quot;: {
    \&quot;x-forwarded-for\&quot;: \&quot;192.168.1.1\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.634Z\&quot;
}
&quot;, &quot;utf8&quot;

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/logger.test.js:232:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Logger Middleware securityLogger should detect and log suspicious patterns" name="Logger Middleware securityLogger should detect and log suspicious patterns" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;suspicious\&quot;:true&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;SECURITY\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test/../../../etc/passwd\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
  \&quot;headers\&quot;: {
    \&quot;x-forwarded-for\&quot;: \&quot;192.168.1.1\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.635Z\&quot;,
  \&quot;suspicious\&quot;: true,
  \&quot;patterns\&quot;: [
    \&quot;/\\\\.\\\\.\\\\//\&quot;
  ]
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;SECURITY\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test/../../../etc/passwd\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
  \&quot;headers\&quot;: {
    \&quot;x-forwarded-for\&quot;: \&quot;192.168.1.1\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.635Z\&quot;,
  \&quot;suspicious\&quot;: true,
  \&quot;patterns\&quot;: [
    \&quot;/\\\\.\\\\.\\\\//\&quot;
  ]
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/logger.test.js:245:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Logger Middleware securityLogger should detect XSS attempts" name="Logger Middleware securityLogger should detect XSS attempts" time="0.001">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: &quot;/mock/logs/path&quot;, StringContaining &quot;\&quot;suspicious\&quot;:true&quot;, &quot;utf8&quot;
Received
       1: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;SECURITY\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
  \&quot;headers\&quot;: {
    \&quot;x-forwarded-for\&quot;: \&quot;192.168.1.1\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.636Z\&quot;,
  \&quot;suspicious\&quot;: true,
  \&quot;patterns\&quot;: [
    \&quot;/&lt;script/i\&quot;
  ]
}
&quot;, &quot;utf8&quot;
       2: &quot;/mock/logs/path&quot;, &quot;{
  \&quot;type\&quot;: \&quot;SECURITY\&quot;,
  \&quot;method\&quot;: \&quot;GET\&quot;,
  \&quot;url\&quot;: \&quot;/test\&quot;,
  \&quot;ip\&quot;: \&quot;192.168.1.1\&quot;,
  \&quot;userAgent\&quot;: \&quot;Mozilla/5.0 (Test Browser)\&quot;,
  \&quot;headers\&quot;: {
    \&quot;x-forwarded-for\&quot;: \&quot;192.168.1.1\&quot;
  },
  \&quot;timestamp\&quot;: \&quot;2025-08-17T22:27:01.636Z\&quot;,
  \&quot;suspicious\&quot;: true,
  \&quot;patterns\&quot;: [
    \&quot;/&lt;script/i\&quot;
  ]
}
&quot;, &quot;utf8&quot;

Number of calls: 2
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/middlewares/__test__/logger.test.js:257:33)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Logger Middleware applyAllLogging should apply all logging middleware to the app" name="Logger Middleware applyAllLogging should apply all logging middleware to the app" time="0.001">
    </testcase>
    <testcase classname="Logger Middleware Integration should work together in a real Express app" name="Logger Middleware Integration should work together in a real Express app" time="0.126">
    </testcase>
  </testsuite>
  <testsuite name="Profile Controller" errors="0" failures="13" skipped="0" timestamp="2025-08-17T22:26:59" time="4.309" tests="15">
    <testcase classname="Profile Controller GET /me should return current user profile" name="Profile Controller GET /me should return current user profile" time="0.018">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller GET /me should return 404 if user not found" name="Profile Controller GET /me should return 404 if user not found" time="0.072">
      <failure>Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)

Expected: 404
Received: 500

Number of calls: 1
    at Object.toHaveBeenCalledWith (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/controllers/__test__/profile.test.js:119:30)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
    <testcase classname="Profile Controller GET /me should return 404 if profile not found" name="Profile Controller GET /me should return 404 if profile not found" time="0.003">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller PUT /me should update current user profile" name="Profile Controller PUT /me should update current user profile" time="0.003">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller PUT /me should handle partial updates" name="Profile Controller PUT /me should handle partial updates" time="0.003">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller GET /:id should return profile by ID with user info" name="Profile Controller GET /:id should return profile by ID with user info" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller GET /:id should return 404 for non-existent profile" name="Profile Controller GET /:id should return 404 for non-existent profile" time="0.004">
    </testcase>
    <testcase classname="Profile Controller GET /:id should return 404 for deleted profile" name="Profile Controller GET /:id should return 404 for deleted profile" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller PUT /:id should update profile by ID" name="Profile Controller PUT /:id should update profile by ID" time="0.005">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller GET / should return all profiles with pagination" name="Profile Controller GET / should return all profiles with pagination" time="0.003">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller GET / should filter profiles by search term" name="Profile Controller GET / should filter profiles by search term" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller POST /:id/restore should restore deleted profile" name="Profile Controller POST /:id/restore should restore deleted profile" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller POST /:id/restore should return 400 if profile is not deleted" name="Profile Controller POST /:id/restore should return 400 if profile is not deleted" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller GET /stats should return profile statistics" name="Profile Controller GET /stats should return profile statistics" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="Profile Controller Error Handling should handle database errors gracefully" name="Profile Controller Error Handling should handle database errors gracefully" time="0.003">
    </testcase>
  </testsuite>
  <testsuite name="User Controller" errors="0" failures="20" skipped="0" timestamp="2025-08-17T22:26:59" time="4.31" tests="26">
    <testcase classname="User Controller POST /register should register a new user successfully" name="User Controller POST /register should register a new user successfully" time="0.081">
      <failure>Error: expected 201 &quot;Created&quot;, got 500 &quot;Internal Server Error&quot;
    at Object.expect (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/controllers/__test__/user.test.js:106:10)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)
----
    at Test._assertStatus (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/supertest/lib/test.js:309:14)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/supertest/lib/test.js:365:13
    at Test._assertFunction (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/supertest/lib/test.js:342:13)
    at Test.assert (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/supertest/lib/test.js:195:23)
    at localAssert (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/supertest/lib/test.js:138:14)
    at Server.&lt;anonymous&gt; (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/supertest/lib/test.js:152:11)
    at Object.onceWrapper (node:events:638:28)
    at Server.emit (node:events:524:28)
    at emitCloseNT (node:net:2344:8)
    at processTicksAndRejections (node:internal/process/task_queues:81:21)</failure>
    </testcase>
    <testcase classname="User Controller POST /register should return 400 for missing email" name="User Controller POST /register should return 400 for missing email" time="0.005">
    </testcase>
    <testcase classname="User Controller POST /register should return 400 for weak password" name="User Controller POST /register should return 400 for weak password" time="0.004">
    </testcase>
    <testcase classname="User Controller POST /register should return 409 for existing email" name="User Controller POST /register should return 409 for existing email" time="0.003">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /login should login successfully with valid credentials" name="User Controller POST /login should login successfully with valid credentials" time="0.004">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /login should return 400 for missing credentials" name="User Controller POST /login should return 400 for missing credentials" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /login should return 401 for invalid credentials" name="User Controller POST /login should return 401 for invalid credentials" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /login should return 403 for inactive account" name="User Controller POST /login should return 403 for inactive account" time="0.003">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller GET /me should return current user profile" name="User Controller GET /me should return current user profile" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller PUT /me should update current user profile" name="User Controller PUT /me should update current user profile" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /forgot-password should handle forgot password request" name="User Controller POST /forgot-password should handle forgot password request" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /reset-password should reset password with valid token" name="User Controller POST /reset-password should reset password with valid token" time="0.003">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /reset-password should return 400 for invalid token" name="User Controller POST /reset-password should return 400 for invalid token" time="0.004">
    </testcase>
    <testcase classname="User Controller POST /verify-email should verify email with valid token" name="User Controller POST /verify-email should verify email with valid token" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller GET /users should return all users with pagination" name="User Controller GET /users should return all users with pagination" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller GET /users should filter users by role" name="User Controller GET /users should filter users by role" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller GET /users/:id should return user by ID" name="User Controller GET /users/:id should return user by ID" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller GET /users/:id should return 404 for non-existent user" name="User Controller GET /users/:id should return 404 for non-existent user" time="0.005">
    </testcase>
    <testcase classname="User Controller PUT /users/:id should update user by ID" name="User Controller PUT /users/:id should update user by ID" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller DELETE /users/:id should soft delete user by ID" name="User Controller DELETE /users/:id should soft delete user by ID" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /users/:id/activate should activate user account" name="User Controller POST /users/:id/activate should activate user account" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /users/:id/deactivate should deactivate user account" name="User Controller POST /users/:id/deactivate should deactivate user account" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /users/:id/unlock should unlock user account" name="User Controller POST /users/:id/unlock should unlock user account" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller POST /logout should logout user successfully" name="User Controller POST /logout should logout user successfully" time="0.003">
    </testcase>
    <testcase classname="User Controller GET /stats should return user statistics" name="User Controller GET /stats should return user statistics" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Controller Error Handling should handle database errors gracefully" name="User Controller Error Handling should handle database errors gracefully" time="0.004">
    </testcase>
  </testsuite>
  <testsuite name="Meta Schema" errors="0" failures="1" skipped="0" timestamp="2025-08-17T22:27:01" time="2.844" tests="14">
    <testcase classname="Meta Schema Schema Definition should have all required meta fields" name="Meta Schema Schema Definition should have all required meta fields" time="0.012">
    </testcase>
    <testcase classname="Meta Schema Schema Definition should set default values correctly" name="Meta Schema Schema Definition should set default values correctly" time="0.001">
    </testcase>
    <testcase classname="Meta Schema Timestamps should set created_at on new document" name="Meta Schema Timestamps should set created_at on new document" time="0.238">
    </testcase>
    <testcase classname="Meta Schema Timestamps should update updated_at on save" name="Meta Schema Timestamps should update updated_at on save" time="0.018">
    </testcase>
    <testcase classname="Meta Schema Soft Delete Methods should soft delete correctly" name="Meta Schema Soft Delete Methods should soft delete correctly" time="0.006">
    </testcase>
    <testcase classname="Meta Schema Soft Delete Methods should restore correctly" name="Meta Schema Soft Delete Methods should restore correctly" time="0.006">
    </testcase>
    <testcase classname="Meta Schema Account Lock Methods should check if account is locked" name="Meta Schema Account Lock Methods should check if account is locked" time="0.001">
    </testcase>
    <testcase classname="Meta Schema Account Lock Methods should increment login attempts correctly" name="Meta Schema Account Lock Methods should increment login attempts correctly" time="0.002">
    </testcase>
    <testcase classname="Meta Schema Account Lock Methods should lock account after 5 failed attempts" name="Meta Schema Account Lock Methods should lock account after 5 failed attempts" time="0.002">
    </testcase>
    <testcase classname="Meta Schema Account Lock Methods should reset login attempts when lock expires" name="Meta Schema Account Lock Methods should reset login attempts when lock expires" time="0.002">
    </testcase>
    <testcase classname="Meta Schema Edge Cases should handle undefined meta gracefully" name="Meta Schema Edge Cases should handle undefined meta gracefully" time="0.004">
    </testcase>
    <testcase classname="Meta Schema Edge Cases should handle null values in meta fields" name="Meta Schema Edge Cases should handle null values in meta fields" time="0.002">
      <failure>Error: expect(received).toBe(expected) // Object.is equality

Expected: 0
Received: null
    at Object.toBe (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/models/__test__/meta.model.test.js:239:42)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Meta Schema Data Persistence should persist meta data correctly" name="Meta Schema Data Persistence should persist meta data correctly" time="0.005">
    </testcase>
    <testcase classname="Meta Schema Data Persistence should update meta fields correctly" name="Meta Schema Data Persistence should update meta fields correctly" time="0.004">
    </testcase>
  </testsuite>
  <testsuite name="Profile model" errors="0" failures="3" skipped="0" timestamp="2025-08-17T22:27:01" time="2.503" tests="4">
    <testcase classname="Profile model should create and find a profile" name="Profile model should create and find a profile" time="0.016">
      <failure>ValidationError: Profile validation failed: userId: Cast to ObjectId failed for value &quot;abc123&quot; (type string) at path &quot;userId&quot; because of &quot;BSONError&quot;, role: Path `role` is required.
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at model.$set (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:1480:12)
    at model.$set (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:1132:16)
    at model.Document (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:178:12)
    at model.Model (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:127:12)
    at new model (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:4837:15)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:2786:20
    at Array.map (&lt;anonymous&gt;)
    at Function.create (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:2774:34)
    at Object.create (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/models/__test__/profile.model.test.js:32:19)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Profile model should set default values" name="Profile model should set default values" time="0.003">
      <failure>ValidationError: Profile validation failed: userId: Cast to ObjectId failed for value &quot;xyz999&quot; (type string) at path &quot;userId&quot; because of &quot;BSONError&quot;, role: Path `role` is required.
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at model.$set (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:1480:12)
    at model.$set (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:1132:16)
    at model.Document (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:178:12)
    at model.Model (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:127:12)
    at new model (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:4837:15)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:2786:20
    at Array.map (&lt;anonymous&gt;)
    at Function.create (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:2774:34)
    at Object.create (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/models/__test__/profile.model.test.js:48:19)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="Profile model should require userId and firstname" name="Profile model should require userId and firstname" time="0.007">
    </testcase>
    <testcase classname="Profile model should not allow duplicate userId" name="Profile model should not allow duplicate userId" time="0.003">
      <failure>ValidationError: Profile validation failed: userId: Cast to ObjectId failed for value &quot;unique&quot; (type string) at path &quot;userId&quot; because of &quot;BSONError&quot;, role: Path `role` is required.
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at model.$set (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:1480:12)
    at model.$set (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:1132:16)
    at model.Document (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:178:12)
    at model.Model (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:127:12)
    at new model (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:4837:15)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:2786:20
    at Array.map (&lt;anonymous&gt;)
    at Function.create (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:2774:34)
    at Object.create (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/models/__test__/profile.model.test.js:62:19)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
  </testsuite>
  <testsuite name="User Model" errors="0" failures="16" skipped="0" timestamp="2025-08-17T22:27:00" time="3.353" tests="25">
    <testcase classname="User Model Schema Definition should have all required fields" name="User Model Schema Definition should have all required fields" time="0.014">
    </testcase>
    <testcase classname="User Model Schema Definition should set default values correctly" name="User Model Schema Definition should set default values correctly" time="0.002">
    </testcase>
    <testcase classname="User Model Validation should require email" name="User Model Validation should require email" time="0.005">
    </testcase>
    <testcase classname="User Model Validation should require password" name="User Model Validation should require password" time="0.003">
    </testcase>
    <testcase classname="User Model Validation should validate email format" name="User Model Validation should validate email format" time="0.004">
    </testcase>
    <testcase classname="User Model Validation should validate password strength" name="User Model Validation should validate password strength" time="0.002">
    </testcase>
    <testcase classname="User Model Validation should validate role enum" name="User Model Validation should validate role enum" time="0.002">
    </testcase>
    <testcase classname="User Model Validation should validate status enum" name="User Model Validation should validate status enum" time="0.002">
    </testcase>
    <testcase classname="User Model Password Hashing should hash password on save" name="User Model Password Hashing should hash password on save" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Password Hashing should not hash password if not modified" name="User Model Password Hashing should not hash password if not modified" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Profile Creation should create profile automatically for new user" name="User Model Profile Creation should create profile automatically for new user" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Profile Creation should not create profile if profileId already exists" name="User Model Profile Creation should not create profile if profileId already exists" time="0.004">
      <failure>ValidationError: Profile validation failed: userId: Cast to ObjectId failed for value &quot;existing-user-id&quot; (type string) at path &quot;userId&quot; because of &quot;BSONError&quot;, role: Path `role` is required.
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at model.$set (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:1480:12)
    at model.$set (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:1132:16)
    at model.Document (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:178:12)
    at model.Model (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:127:12)
    at new model (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/model.js:4837:15)
    at Object.&lt;anonymous&gt; (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/models/__test__/user.model.test.js:234:31)
    at Promise.finally.completed (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)
    at new Promise (&lt;anonymous&gt;)
    at callAsyncCircusFn (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)
    at _callCircusTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at _runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:949:3)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
    at run (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)
    at jestAdapter (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-circus/build/runner.js:101:19)
    at runTestInternal (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:272:16)
    at runTest (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:340:7)
    at Object.worker (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/jest-runner/build/testWorker.js:494:12)</failure>
    </testcase>
    <testcase classname="User Model Meta Integration should create meta object automatically" name="User Model Meta Integration should create meta object automatically" time="0.003">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Meta Integration should delegate isLocked to meta" name="User Model Meta Integration should delegate isLocked to meta" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Meta Integration should delegate incLoginAttempts to meta" name="User Model Meta Integration should delegate incLoginAttempts to meta" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Meta Integration should delegate softDelete to meta" name="User Model Meta Integration should delegate softDelete to meta" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Meta Integration should delegate restore to meta" name="User Model Meta Integration should delegate restore to meta" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Instance Methods should compare password correctly" name="User Model Instance Methods should compare password correctly" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Static Methods should find by email" name="User Model Static Methods should find by email" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Static Methods should find active users" name="User Model Static Methods should find active users" time="0.002">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Static Methods should find non-deleted users" name="User Model Static Methods should find non-deleted users" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Virtuals should have fullName virtual" name="User Model Virtuals should have fullName virtual" time="0.001">
      <failure>ValidationError: User validation failed: profileId: Profile reference is required
    at model.Document.invalidate (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3352:32)
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/document.js:3113:17
    at /Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongoose/lib/schemaType.js:1410:9
    at processTicksAndRejections (node:internal/process/task_queues:77:11)</failure>
    </testcase>
    <testcase classname="User Model Indexes should have proper indexes" name="User Model Indexes should have proper indexes" time="0.003">
      <failure>MongoServerError: ns does not exist: test.users
    at Connection.sendCommand (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/cmap/connection.ts:559:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at Connection.command (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/cmap/connection.ts:633:22)
    at Server.command (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/sdam/server.ts:342:21)
    at ListIndexesOperation.executeCommand (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/operations/command.ts:179:12)
    at ListIndexesOperation.execute (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/operations/indexes.ts:409:12)
    at tryOperation (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/operations/execute_operation.ts:283:14)
    at executeOperation (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/operations/execute_operation.ts:115:12)
    at ListIndexesCursor._initialize (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/cursor/list_indexes_cursor.ts:33:22)
    at ListIndexesCursor.cursorInit (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/cursor/abstract_cursor.ts:944:21)
    at ListIndexesCursor.fetchBatch (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/cursor/abstract_cursor.ts:982:7)
    at ListIndexesCursor.next (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/cursor/abstract_cursor.ts:612:9)
    at ListIndexesCursor.[Symbol.asyncIterator] (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/cursor/abstract_cursor.ts:506:26)
    at ListIndexesCursor.toArray (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/cursor/abstract_cursor.ts:700:22)
    at Collection.indexes (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/node_modules/mongodb/src/collection.ts:879:45)
    at Object.&lt;anonymous&gt; (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/models/__test__/user.model.test.js:429:23)</failure>
    </testcase>
    <testcase classname="User Model Edge Cases should handle missing meta gracefully" name="User Model Edge Cases should handle missing meta gracefully" time="0.004">
    </testcase>
    <testcase classname="User Model Edge Cases should handle profile creation errors gracefully" name="User Model Edge Cases should handle profile creation errors gracefully" time="0.004">
      <failure>Error: expect(received).toBe(expected) // Object.is equality

Expected: &quot;Profile save failed&quot;
Received: &quot;User validation failed: profileId: Profile reference is required&quot;
    at Object.toBe (/Users/farid/Desktop/Projects/Team/YabaIT/KizunaTravelOS/apps/erp-api/src/models/__test__/user.model.test.js:476:29)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)</failure>
    </testcase>
  </testsuite>
</testsuites>